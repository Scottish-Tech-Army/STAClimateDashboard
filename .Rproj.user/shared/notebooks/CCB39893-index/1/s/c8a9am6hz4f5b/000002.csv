"0",""
"0","#extract latest year and sum emissions per sector and sub categories"
"0","ghg_tree <- scot_ghg_clean %>%"
"0","  filter(year == last_year) %>%"
"0","  select(-year) %>%"
"0","  group_by(sg_categories, source_name, source_sub_cat) %>%"
"0","  summarise(emissions = sum(emissions)) %>%"
"0","  ungroup()"
"1","`summarise()` has grouped output by 'sg_categories', 'source_name'. You can override using the `.groups` argument.
"
"0","# create the hierarchial dataset"
"0","parents_top <- tibble("
"0","  ids = ""<b>Greenhouse\nGas\nEmissions</b>"","
"0","  emissions = sum(ghg_tree$emissions),"
"0","  parents = """","
"0","  labels = ""<b>Greenhouse\nGas\nEmissions</b>"")"
"0",""
"0","parents <- ghg_tree %>%"
"0","  group_by(sg_categories) %>%"
"0","  summarise(emissions = sum(emissions, na.rm = TRUE)) %>%"
"0","  mutate(parents = ""<b>Greenhouse\nGas\nEmissions</b>"","
"0","         labels = sg_categories,"
"0","         ids = paste0(""<b>Greenhouse\nGas\nEmissions</b> - "", sg_categories)) %>%"
"0","  select(-sg_categories)"
"0",""
"0","second_level <- ghg_tree %>%"
"0","  mutate(ids = paste0(""<b>Greenhouse\nGas\nEmissions</b> - "", sg_categories, "" - "", source_name),"
"0","         labels = source_name,"
"0","         parents = paste0(""<b>Greenhouse\nGas\nEmissions</b>"", "" - "", sg_categories)) %>%"
"0","  select(-sg_categories) %>%"
"0","  group_by(ids, parents, labels) %>%"
"0","  summarise(emissions = sum(emissions, na.rm = TRUE))"
"1","`summarise()` has grouped output by 'ids', 'parents'. You can override using the `.groups` argument.
"
"0","third_level <- ghg_tree %>%"
"0","  drop_na(source_sub_cat) %>%"
"0","  mutate(ids = paste0(""<b>Greenhouse\nGas\nEmissions</b> - "", sg_categories, "" - "", source_name, "" - "", source_sub_cat),"
"0","         parents = paste0(""<b>Greenhouse\nGas\nEmissions</b> - "", sg_categories, "" - "", source_name)) %>%"
"0","  rename(labels = source_sub_cat) %>%"
"0","  ungroup() %>%"
"0","  select(ids, parents, labels, emissions)"
"0",""
"0","# combine all levels or heirarchy"
"0","ghg_hierarchy <- bind_rows(parents_top, parents, second_level, third_level)"
