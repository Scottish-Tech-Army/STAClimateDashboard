"0",""
"0","# Calculate total greenhouse gas emissions per sector per year"
"0","ghg_sector_total <- scot_ghg_clean %>%"
"0","  group_by(year, sg_categories) %>%"
"0","  summarise(total_emissions = sum(emissions)) %>%"
"0","  rename(sector = sg_categories) %>%"
"0","  mutate(sector = recode(sector, "
"0","                                   ""Domestic\nTransport"" = ""Domestic Transport"","
"0","                                   ""Business\n&\nIndustry"" = ""Business & Industry"")) "
"1","`summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
"
"0","# Order the sectors by greatest decrease in emissions"
"0","ghg_sector_total_plot <- ghg_sector_total %>%"
"0","  group_by(sector) %>%"
"0","  arrange(year) %>%"
"0","  mutate(emission_drop = last(total_emissions) - first(total_emissions),"
"0","         emission_drop = replace_na(emission_drop, 0)) %>%"
"0","   ungroup() %>%"
"0","  mutate(sector = fct_reorder(sector, emission_drop))"
"0",""
"0","#colours to match sunburst"
"0","colors <- viridis(10, direction = -1, end = 0.9)"
"0",""
"0","#create list of sectors with colors ordered by last year emissions"
"0","sector_list <- ghg_sector_total_plot %>%"
"0","  arrange(year) %>%"
"0","  filter(year == last_year) %>%"
"0","  select(sector, total_emissions, emission_drop) %>%"
"0","  arrange (desc(total_emissions))"
"0","#add colors to df to match sunburst"
"0","sector_list$sector_colors = colors"
"0",""
"0","#arrange colours to match plot order"
"0","sector_list_color <- sector_list %>%"
"0","  arrange (emission_drop) %>%"
"0","  select (sector_colors)"
"0",""
"0","# Label positionings for the stacked area plot"
"0","ghg_subs <- ghg_sector_total_plot %>%"
"0","  filter(year == 1995) %>%"
"0","  ungroup() %>%"
"0","  arrange(desc(sector)) %>%"
"0","  mutate(cum = cumsum(total_emissions),"
"0","         gap = cum - lag(cum),"
"0","         gap = coalesce(gap, 0.5),"
"0","         position = cum - (gap/2))"
"0",""
"0","#stacked area plot"
"0","  ghg_sector_total_plot %>%"
"0","  ggplot() +"
"0","  aes(x = year, y = total_emissions, group = sector, fill = sector) +"
"0","  geom_area() +"
"0","  scale_fill_manual(values = as.matrix(sector_list_color))+"
"0","  theme_light() +"
"0","  scale_x_continuous(breaks = seq(first(ghg_sector_total_plot$year),"
"0","                                  last(ghg_sector_total_plot$year), 2)) +"
"0","    geom_text(data = ghg_subs,"
"0","          aes(x = 1995, y = position,"
"0","              label = sector),"
"0","          colour = ""black"","
"0","          hjust = 0) +"
"0","  # labels"
"0","    theme(legend.position = ""none"","
"0","         panel.grid = element_blank(),"
"0","         axis.text = element_text(face = ""bold"")) +"
"0","   labs(x = ""Year"","
"0","        y = ""Total Greenhouse Gas Emissions (Mt CO2)"")"
